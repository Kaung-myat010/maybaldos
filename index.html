<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="theme-color" content="#6800f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/maybaldos/icons/icon-192x192.png">
    <link rel="apple-touch-icon" sizes="512x512" href="/maybaldos/icons/icon-512x512.png">
    <link rel="manifest" href="/maybaldos/manifest.json">
  <title>Dress Designer Order Records</title> 
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"> 
  <link href="https://fonts.googleapis.com/css2?family=Padauk&amp;display=swap" rel="stylesheet"> 
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar&amp;display=swap" rel="stylesheet"> 
  <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Padauk', 'Myanmar Text', 'Noto Sans Myanmar', sans-serif;
        }

        body {
            font-family: 'Segoe UI', 'Padauk', 'Myanmar Text', 'Noto Sans Myanmar', sans-serif;
            background: linear-gradient(45deg, #e7bedc,#e7bedc, #a666da,
             #b85ea9, #b85ea9 ,#e7bedc,#e7bedc,#e7bedc);
            background-size: 600% 600%;
            animation: gradientBG 15s ease infinite;
            color: #3A3A3A;
            padding: 20px;
        }

        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }

        .container {
            max-width: 700px;
            margin: 20px auto;
            padding: 20px;
            background: rgba(255, 255, 255, 0.692);
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            position: relative;
        }

        h1, h2 {
            text-align: center;
            color: rgba(104, 0, 241, 0.753);
            text-shadow: 0 0 8px #ffffffa4;
            font-family: 'Padauk', 'Myanmar Text', sans-serif;
        }
        h1 { margin-bottom: 25px; }
        h2 { margin-bottom: 10px; margin-top: 15px; font-size: 1.2em; }

        .footer-credit {
            text-align: center;
            font-size: 10px;
            color: rgba(56, 43, 43, 0.5);
            margin-top: 15px;
        }

        #overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.3);
            z-index: 15;
            display: none;
            backdrop-filter: blur(4px);
        }
        
        /* Order System Styles */
        #orderSystem { display: none; }
        #orderSystem.visible { display: block; }
        #orderControls { display: flex; justify-content: space-between; margin-bottom: 15px; gap: 10px; }

        #createOrderBtn, #actionOrderBtn, #backToOrdersBtn {
            background: linear-gradient(45deg, rgb(133, 61, 228), rgb(169, 117, 238));
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.253);
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.2);
            transition: 0.3s ease;
        }
        #createOrderBtn:hover, #actionOrderBtn:hover, #backToOrdersBtn:hover {
            transform: scale(1.02);
        }
        #backToOrdersBtn {
            background: linear-gradient(45deg, #666, #999);
        }

        #orderList {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .order-item {
            background: rgba(255, 255, 255, 0.8);
            border-radius: 10px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }

        .order-item:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .order-icon {
            font-size: 40px;
            color: rgba(104, 0, 241, 0.753);
            margin-bottom: 10px;
        }

        .order-name {
            font-weight: bold;
            color: #3A3A3A;
            word-break: break-word;
        }
        
        .order-status-badge {
            font-size: 0.7rem;
            padding: 2px 6px;
            border-radius: 5px;
            color: white;
            margin-top: 8px;
            display: inline-block;
        }
        .status-pending { background-color: #42a5f5; }
        .status-in-progress { background-color: #ef5350; }
        .status-completed { background-color: rgb(133, 61, 228); }


        .order-checkbox {
            position: absolute;
            top: 10px;
            left: 10px;
            display: none;
        }

        #orderList.selection-mode .order-checkbox { display: block; }
        #orderList.selection-mode .order-item { opacity: 0.7; }
        #orderList.selection-mode .order-item.selected {
            opacity: 1;
            border: 2px solid rgba(104, 0, 241, 0.753);
        }

        /* Order Form & Action Island Styles */
        #orderFormContainer, #orderActionIsland {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), 0 0 15px rgba(104, 0, 241, 0.3);
            backdrop-filter: blur(15px);
            border: 1px solid rgba(255, 255, 255, 0.3);
            opacity: 0;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 35;
            width: 300px;
        }

        #orderFormContainer.visible, #orderActionIsland.visible {
            transform: translate(-50%, -50%) scale(1);
            opacity: 1;
        }
        
        #orderActionIsland { display: flex; gap: 10px; padding: 10px; z-index: 30; }

        #orderForm { display: flex; flex-direction: column; gap: 12px; }
        #orderForm input { padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: rgba(255, 255, 255, 0.7); }
        #orderForm button {
            background: linear-gradient(45deg, rgb(133, 61, 228), rgb(169, 117, 238));
            color: white; padding: 10px; border-radius: 12px; cursor: pointer; font-weight: bold; border: none;
        }

        .action-icon {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; cursor: pointer; transition: all 0.3s ease; color: white; font-size: 18px;
        }
        .action-icon.edit-icon { background: linear-gradient(45deg, #42a5f5, #64b5f6); }
        .action-icon.delete-icon { background: linear-gradient(45deg, #ef5350, #e57373); }
        
        /* Order Detail View Styles */
        #orderDetailView { 
            display: none; 
            position: relative; /* Needed for positioning the close button */
        }
        #orderDetailView.visible { display: block; }

        .close-btn {
            position: absolute;
            top: -10px;
            right: -5px;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: none;
            background: rgba(0,0,0,0.1);
            color: #333;
            font-size: 20px;
            font-weight: bold;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            line-height: 1;
            transition: all 0.2s ease;
        }
        .close-btn:hover {
            background: rgba(0,0,0,0.2);
            transform: scale(1.1);
        }
        
        #detailContainer {
            background: rgba(255, 255, 255, 0.897);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        #orderDetailForm .form-group { margin-bottom: 15px; }
        #orderDetailForm label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        #orderDetailForm input, #orderDetailForm textarea, #orderDetailForm select {
            width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;
            background: rgba(255, 255, 255, 0.9); font-size: 1em;
        }
        #orderDetailForm textarea { resize: vertical; min-height: 80px; }

        .image-preview-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 10px;
        }
        .image-preview-box { text-align: center; }
        .image-preview {
            width: 100%; height: 150px; border-radius: 8px; background: #eee;
            object-fit: cover; border: 2px dashed #ccc; cursor: pointer;
        }
        .image-preview-box input[type="file"] { display: none; }
        
        /* Dialog Styles */
        #orderConfirmDialog {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2); z-index: 40; text-align: center; width: 300px;
        }
        #orderConfirmDialog p { color: #242424; margin-bottom: 20px; font-size: 1.1em; }
        .dialog-buttons { display: flex; gap: 10px; justify-content: center; }
        .dialog-buttons button {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            color: white; font-weight: bold; flex-grow: 1;
        }
        .confirm-btn { background: #ef5350; }
        .cancel-btn { background: #64b5f6; }

        .footer-credit{
            font-weight: bold;
        }


        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.5em; }
            #orderList { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            .image-preview-container { grid-template-columns: 1fr; }
            .image-preview { height: 200px; }
            #orderFormContainer, #orderActionIsland, #orderConfirmDialog {
                width: calc(100% - 40px);
            }
        }
    </style> 
 </head> 
 <body> 
  <div class="container"> 
   <h1>Dress Order Records</h1> 
   <div id="overlay"></div> 
   <div id="orderSystem" class="visible"> 
    <div id="orderControls"> <button id="createOrderBtn">New Order</button> <button id="actionOrderBtn">Actions</button> <button id="backToOrdersBtn" style="display:none">Back</button> 
    </div> 
    <div id="orderList"></div> 
   </div> 
   <div id="orderFormContainer"> 
    <form id="orderForm"> 
     <input type="text" id="orderNameInput" placeholder="Order Name (e.g., Customer's Name)" required> <button type="submit" id="orderFormSubmitBtn">Create</button> 
    </form> 
   </div> 
   <div id="orderActionIsland"> 
    <div class="action-icon edit-icon" id="orderIslandEditBtn" title="Edit Name">
     üñãÔ∏è
    </div> 
    <div class="action-icon delete-icon" id="orderIslandDeleteBtn" title="Delete Order">
     üóëÔ∏è
    </div> 
   </div> 
   <div id="orderConfirmDialog"> 
    <p>Are you sure you want to delete this order(s)?</p> 
    <div class="dialog-buttons"> <button id="confirmOrderDelete" class="confirm-btn">Delete</button> <button id="cancelOrderDelete" class="cancel-btn">Cancel</button> 
    </div> 
   </div> 
   <div id="orderDetailView"> <button id="closeDetailViewBtn" class="close-btn" title="Close">√ó</button> 
    <div id="detailContainer"> 
     <h2 id="displayOrderName"></h2> 
     <form id="orderDetailForm"> 
      <div class="form-group"> <label for="customerName">Customer Name</label> 
       <input type="text" id="customerName" placeholder="Enter customer's name"> 
      </div> 
      <div class="form-group"> <label for="orderStatus">Status</label> <select id="orderStatus"> <option value="pending">Pending</option> <option value="in-progress">In Progress</option> <option value="completed">Completed</option> </select> 
      </div> 
      <div class="form-group"> <label for="orderDeadline">Deadline</label> 
       <input type="date" id="orderDeadline"> 
      </div> 
      <div class="form-group"> <label for="fittingDate">Fitting Date</label> 
       <input type="date" id="fittingDate"> 
      </div> 
      <div class="form-group"> <label for="pickupDate">Pickup Date</label> 
       <input type="date" id="pickupDate"> 
      </div> 
      <div class="form-group"> <label for="orderNotes">Notes</label> <textarea id="orderNotes" placeholder="Special requests, measurements, etc."></textarea> 
      </div> 
      <div class="image-preview-container"> 
       <div class="image-preview-box"> <label for="fabricImageFile">Fabric Image</label> 
        <img id="fabricImagePreview" class="image-preview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Fabric Preview"> 
        <input type="file" id="fabricImageFile" accept="image/*"> 
       </div> 
       <div class="image-preview-box"> <label for="designImageFile">Design Image</label> 
        <img id="designImagePreview" class="image-preview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Design Preview"> 
        <input type="file" id="designImageFile" accept="image/*"> 
       </div> 
      </div> 
     </form> 
    </div> 
    <div class="footer-credit">
     ¬©Ô∏è Aung Kaung Myat Production
    </div> 
   </div> 
  </div> 
  <script>
        document.addEventListener('DOMContentLoaded', () => {
            // DOM Elements
            const elements = {
                orderSystem: document.getElementById('orderSystem'),
                orderList: document.getElementById('orderList'),
                createOrderBtn: document.getElementById('createOrderBtn'),
                actionOrderBtn: document.getElementById('actionOrderBtn'),
                backToOrdersBtn: document.getElementById('backToOrdersBtn'),
                orderFormContainer: document.getElementById('orderFormContainer'),
                orderForm: document.getElementById('orderForm'),
                orderNameInput: document.getElementById('orderNameInput'),
                orderFormSubmitBtn: document.getElementById('orderFormSubmitBtn'),
                orderActionIsland: document.getElementById('orderActionIsland'),
                orderIslandEditBtn: document.getElementById('orderIslandEditBtn'),
                orderIslandDeleteBtn: document.getElementById('orderIslandDeleteBtn'),
                orderConfirmDialog: document.getElementById('orderConfirmDialog'),
                confirmOrderDelete: document.getElementById('confirmOrderDelete'),
                cancelOrderDelete: document.getElementById('cancelOrderDelete'),
                orderDetailView: document.getElementById('orderDetailView'),
                closeDetailViewBtn: document.getElementById('closeDetailViewBtn'),
                displayOrderName: document.getElementById('displayOrderName'),
                orderDetailForm: document.getElementById('orderDetailForm'),
                fabricImagePreview: document.getElementById('fabricImagePreview'),
                fabricImageFile: document.getElementById('fabricImageFile'),
                designImagePreview: document.getElementById('designImagePreview'),
                designImageFile: document.getElementById('designImageFile'),
                overlay: document.getElementById('overlay')
            };

            let currentOrderId = null;
            let editOrderId = null;
            let isSelectionMode = false;
            let selectedOrders = new Set();
            
            const blankImage = "data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";

            // --- Main Logic ---
            loadOrders();

            // --- Event Listeners ---
            elements.createOrderBtn.addEventListener('click', () => showOrderForm());
            elements.actionOrderBtn.addEventListener('click', toggleSelectionMode);
            elements.backToOrdersBtn.addEventListener('click', closeOrderDetailView);
            elements.closeDetailViewBtn.addEventListener('click', closeOrderDetailView);
            elements.overlay.addEventListener('click', handleOverlayClick);
            elements.orderForm.addEventListener('submit', handleOrderFormSubmit);
            elements.orderIslandEditBtn.addEventListener('click', handleEditOrderName);
            elements.orderIslandDeleteBtn.addEventListener('click', () => showPopup(elements.orderConfirmDialog));
            elements.confirmOrderDelete.addEventListener('click', handleDeleteOrders);
            elements.cancelOrderDelete.addEventListener('click', () => hideAllPopups());
            elements.orderDetailForm.addEventListener('input', () => saveCurrentOrderData(true));
            elements.fabricImagePreview.addEventListener('click', () => elements.fabricImageFile.click());
            elements.designImagePreview.addEventListener('click', () => elements.designImageFile.click());
            elements.fabricImageFile.addEventListener('change', (e) => handleImageUpload(e, 'fabricImage', elements.fabricImagePreview));
            elements.designImageFile.addEventListener('change', (e) => handleImageUpload(e, 'designImage', elements.designImageFile));

            // --- Data Functions ---
            function getOrders() {
                return JSON.parse(localStorage.getItem('orders')) || [];
            }

            function saveOrders(orders) {
                localStorage.setItem('orders', JSON.stringify(orders));
            }

            // --- Order List Functions ---
            function loadOrders() {
                const orders = getOrders();
                elements.orderList.innerHTML = '';
                if (orders.length === 0) {
                    elements.orderList.innerHTML = '<p style="grid-column: 1/-1; text-align: center; color: #666;">No orders yet. Click "New Order" to start.</p>';
                } else {
                    orders.forEach(order => {
                        const orderElement = createOrderElement(order);
                        elements.orderList.appendChild(orderElement);
                    });
                }
            }

            function createOrderElement(order) {
                const element = document.createElement('div');
                element.className = 'order-item';
                element.dataset.orderId = order.id;
                
                const statusClass = `status-${(order.status || 'pending').replace(' ', '-')}`;

                element.innerHTML = `
                    <input type="checkbox" class="order-checkbox" data-order-id="${order.id}">
                    <div class="order-icon"><i class="fas fa-tshirt"></i></div>
                    <div class="order-name">${order.orderName}</div>
                    <div class="order-status-badge ${statusClass}">${(order.status || 'pending').replace('-', ' ')}</div>
                `;

                element.addEventListener('click', (e) => {
                    if (isSelectionMode) {
                        e.preventDefault();
                        const checkbox = element.querySelector('.order-checkbox');
                        checkbox.checked = !checkbox.checked;
                        toggleOrderSelection(order.id);
                    } else {
                        openOrderDetailView(order.id);
                    }
                });
                return element;
            }

            function toggleSelectionMode() {
                isSelectionMode = !isSelectionMode;
                selectedOrders.clear();
                elements.orderList.classList.toggle('selection-mode', isSelectionMode);
                elements.actionOrderBtn.textContent = isSelectionMode ? 'Done' : 'Actions';
                document.querySelectorAll('.order-checkbox').forEach(cb => cb.checked = false);
                document.querySelectorAll('.order-item').forEach(item => item.classList.remove('selected'));
                if (!isSelectionMode) {
                    elements.orderActionIsland.classList.remove('visible');
                }
            }

            function toggleOrderSelection(orderId) {
                const orderElement = document.querySelector(`.order-item[data-order-id="${orderId}"]`);
                if (selectedOrders.has(orderId)) {
                    selectedOrders.delete(orderId);
                    orderElement.classList.remove('selected');
                } else {
                    selectedOrders.add(orderId);
                    orderElement.classList.add('selected');
                }
                if (selectedOrders.size > 0) {
                    elements.orderActionIsland.classList.add('visible');
                } else {
                    elements.orderActionIsland.classList.remove('visible');
                }
            }

            // --- Order Name Form (Create/Edit) ---
            function showOrderForm(isEdit = false) {
                editOrderId = isEdit ? [...selectedOrders][0] : null;
                elements.orderFormSubmitBtn.textContent = isEdit ? 'Update Name' : 'Create Order';
                
                if (isEdit) {
                    const orders = getOrders();
                    const orderToEdit = orders.find(o => o.id === editOrderId);
                    elements.orderNameInput.value = orderToEdit ? orderToEdit.orderName : '';
                } else {
                    elements.orderForm.reset();
                }
                showPopup(elements.orderFormContainer);
            }
            
            function handleEditOrderName(){
                if (selectedOrders.size !== 1) {
                    alert('Please select exactly one order to edit its name.');
                    return;
                }
                showOrderForm(true);
            }

            function handleOrderFormSubmit(e) {
                e.preventDefault();
                const orderName = elements.orderNameInput.value.trim();
                if (!orderName) return alert('Order name cannot be empty.');
                
                const orders = getOrders();
                if (editOrderId) { // Editing
                    const orderIndex = orders.findIndex(o => o.id === editOrderId);
                    if (orderIndex !== -1) orders[orderIndex].orderName = orderName;
                } else { // Creating
                    const newOrder = {
                        id: Date.now().toString(),
                        orderName,
                        customerName: '',
                        deadline: '',
                        fittingDate: '',
                        pickupDate: '',
                        notes: '',
                        fabricImage: null,
                        designImage: null,
                        status: 'pending'
                    };
                    orders.push(newOrder);
                }
                
                saveOrders(orders);
                loadOrders();
                hideAllPopups();
            }
            
            function handleDeleteOrders(){
                let orders = getOrders();
                orders = orders.filter(o => !selectedOrders.has(o.id));
                saveOrders(orders);
                loadOrders();
                hideAllPopups();
            }

            // --- Order Detail View ---
            function openOrderDetailView(orderId) {
                currentOrderId = orderId;
                const orders = getOrders();
                const order = orders.find(o => o.id === orderId);
                if (!order) return;

                elements.displayOrderName.textContent = order.orderName;
                document.getElementById('customerName').value = order.customerName || '';
                document.getElementById('orderStatus').value = order.status || 'pending';
                document.getElementById('orderDeadline').value = order.deadline || '';
                document.getElementById('fittingDate').value = order.fittingDate || '';
                document.getElementById('pickupDate').value = order.pickupDate || '';
                document.getElementById('orderNotes').value = order.notes || '';
                elements.fabricImagePreview.src = order.fabricImage || blankImage;
                elements.designImagePreview.src = order.designImage || blankImage;

                elements.orderSystem.classList.remove('visible');
                elements.orderDetailView.classList.add('visible');
                elements.backToOrdersBtn.style.display = 'block';
                elements.createOrderBtn.style.display = 'none';
                elements.actionOrderBtn.style.display = 'none';
            }

            function closeOrderDetailView() {
                saveCurrentOrderData(false);
                currentOrderId = null;
                elements.orderSystem.classList.add('visible');
                elements.orderDetailView.classList.remove('visible');
                elements.backToOrdersBtn.style.display = 'none';
                elements.createOrderBtn.style.display = 'block';
                elements.actionOrderBtn.style.display = 'block';
                if(isSelectionMode) toggleSelectionMode();
                loadOrders(); // Refresh to show updated status badges
            }

            function saveCurrentOrderData(isLiveUpdate) {
                if (!currentOrderId) return;
                
                const orders = getOrders();
                const orderIndex = orders.findIndex(o => o.id === currentOrderId);
                if (orderIndex === -1) return;

                const updatedOrderData = {
                    customerName: document.getElementById('customerName').value,
                    status: document.getElementById('orderStatus').value,
                    deadline: document.getElementById('orderDeadline').value,
                    fittingDate: document.getElementById('fittingDate').value,
                    pickupDate: document.getElementById('pickupDate').value,
                    notes: document.getElementById('orderNotes').value,
                };
                
                // Merge new data with existing data to preserve unchanged values and images
                orders[orderIndex] = { ...orders[orderIndex], ...updatedOrderData };
                saveOrders(orders);
            }

            // --- Image Handling ---
            function convertToBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result);
                    reader.onerror = error => reject(error);
                });
            }

            async function handleImageUpload(event, imageType, previewElement) {
                const file = event.target.files[0];
                if (!file) return;

                try {
                    const base64 = await convertToBase64(file);
                    previewElement.src = base64;
                    const orders = getOrders();
                    const orderIndex = orders.findIndex(o => o.id === currentOrderId);
                    if (orderIndex !== -1) {
                        orders[orderIndex][imageType] = base64;
                        saveOrders(orders);
                    }
                } catch (error) {
                    console.error('Error converting image to Base64:', error);
                    alert('Failed to load image.');
                }
            }
            
            // --- UI & Popup Functions (FIXED LOGIC) ---
            function showPopup(popupElement) {
                elements.overlay.style.display = 'block';
                popupElement.classList.add('visible');
            }

            function hideAllPopups() {
                elements.overlay.style.display = 'none';
                [
                    elements.orderFormContainer, 
                    elements.orderConfirmDialog, 
                    elements.orderActionIsland
                ].forEach(el => el.classList.remove('visible'));
                
                if (isSelectionMode) {
                    toggleSelectionMode();
                }
            }

            function handleOverlayClick() {
                hideAllPopups();
            }
        });
    </script> 
    <script>
    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/serviceworker.js') // path to your serviceworker.js file
                .then(registration => {
                    console.log('Service Worker registered with scope:', registration.scope);
                })
                .catch(error => {
                    console.error('Service Worker registration failed:', error);
                });
        });
    }
</script>

 
</body></html>