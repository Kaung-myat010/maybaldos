<!doctype html>
<html lang="my">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Dress Designer Order Records</title>
    
    <meta name="theme-color" content="#6800f1">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="/maybaldos/icons/icon-192x192.png"> <link rel="apple-touch-icon" sizes="512x512" href="/maybaldos/icons/icon-512x512.png"> <link rel="manifest" href="manifest.json"> <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Padauk&amp;display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Myanmar&amp;display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: rgba(104, 0, 241, 0.753);
            --primary-gradient: linear-gradient(45deg, rgb(133, 61, 228), rgb(169, 117, 238));
        }
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Padauk', 'Myanmar Text', 'Noto Sans Myanmar', sans-serif;
        }
        body {
            font-family: 'Segoe UI', 'Padauk', 'Myanmar Text', 'Noto Sans Myanmar', sans-serif;
            background: linear-gradient(45deg, #e7bedc,#e7bedc, #a666da, #b85ea9, #b85ea9 ,#e7bedc,#e7bedc,#e7bedc);
            background-size: 600% 600%;
            animation: gradientBG 15s ease infinite;
            color: #3A3A3A;
            padding: 20px;
        }
        @keyframes gradientBG {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        .container {
            max-width: 700px; margin: 20px auto; padding: 20px;
            background: rgba(255, 255, 255, 0.692); border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1); backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.2); position: relative;
        }
        h1, h2 {
            text-align: center; color: var(--primary-color);
            text-shadow: 0 0 8px #ffffffa4;
            font-family: 'Padauk', 'Myanmar Text', sans-serif;
        }
        h1 { margin-bottom: 25px; }
        h2 { margin-bottom: 10px; margin-top: 15px; font-size: 1.2em; }
        .footer-credit {
            text-align: center; font-size: 10px;
            color: rgba(56, 43, 43, 0.5); margin-top: 15px; font-weight: bold;
        }
        #overlay {
            position: fixed; top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0,0,0,0.3); z-index: 15;
            display: none; backdrop-filter: blur(4px);
        }
        #orderSystem { display: block; }
        #orderControls { display: flex; justify-content: space-between; margin-bottom: 15px; gap: 10px; }
        #createOrderBtn, #actionOrderBtn, #backToOrdersBtn, #cancelSelectionBtn {
            background: var(--primary-gradient); color: white; padding: 8px 15px;
            border-radius: 8px; cursor: pointer; box-shadow: 0 3px 8px rgba(0, 0, 0, 0.253);
            font-weight: bold; border: 1px solid rgba(255, 255, 255, 0.2); transition: 0.3s ease;
        }
        #createOrderBtn:hover, #actionOrderBtn:hover, #backToOrdersBtn:hover, #cancelSelectionBtn:hover { transform: scale(1.02); }
        #backToOrdersBtn, #cancelSelectionBtn { background: linear-gradient(45deg, #666, #999); }
        #cancelSelectionBtn { display: none; }
        #orderList {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 15px; margin-top: 15px;
        }
        .order-item {
            background: rgba(255, 255, 255, 0.8); border-radius: 10px; padding: 15px;
            text-align: center; cursor: pointer; transition: all 0.3s ease;
            position: relative; box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .order-item:hover { transform: translateY(-5px); box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2); }
        .order-icon { font-size: 40px; color: var(--primary-color); margin-bottom: 10px; }
        .order-name { font-weight: bold; color: #3A3A3A; word-break: break-word; }
        .order-status-badge {
            font-size: 0.7rem; padding: 2px 6px; border-radius: 5px; color: white;
            margin-top: 8px; display: inline-block;
        }
        .status-pending { background-color: #42a5f5; }
        .status-in-progress { background-color: #ef5350; }
        .status-completed { background-color: rgb(133, 61, 228); }
        .order-checkbox {
            position: absolute; top: 10px; left: 10px; display: none;
            width: 18px; height: 18px;
        }
        #orderList.selection-mode .order-checkbox { display: block; }
        #orderList.selection-mode .order-item { opacity: 0.7; }
        #orderList.selection-mode .order-item.selected {
            opacity: 1; border: 2px solid var(--primary-color);
        }
        #orderFormContainer, #orderActionIsland {
            position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0);
            background: rgba(255, 255, 255, 0.95); border-radius: 20px;
            padding: 20px; box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2), 0 0 15px rgba(104, 0, 241, 0.3);
            backdrop-filter: blur(15px); border: 1px solid rgba(255, 255, 255, 0.3);
            opacity: 0; transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            z-index: 35; width: 300px;
        }
        #orderFormContainer.visible, #orderActionIsland.visible {
            transform: translate(-50%, -50%) scale(1); opacity: 1;
        }
        #orderActionIsland { display: flex; gap: 10px; padding: 10px; z-index: 30; }
        #orderForm { display: flex; flex-direction: column; gap: 12px; }
        #orderForm input { padding: 10px; border-radius: 8px; border: 1px solid #ddd; background: rgba(255, 255, 255, 0.7); }
        #orderForm button {
            background: var(--primary-gradient); color: white; padding: 10px;
            border-radius: 12px; cursor: pointer; font-weight: bold; border: none;
        }
        .action-icon {
            width: 40px; height: 40px; border-radius: 50%; display: flex; align-items: center;
            justify-content: center; cursor: pointer; transition: all 0.3s ease; color: white; font-size: 18px;
        }
        .action-icon.delete-icon { background: linear-gradient(45deg, #ef5350, #e57373); }
        #orderDetailView { display: none; position: relative; }
        .close-btn {
            position: absolute; top: -10px; right: -5px; width: 30px; height: 30px;
            border-radius: 50%; border: none; background: rgba(0,0,0,0.1);
            color: #333; font-size: 20px; font-weight: bold; cursor: pointer;
            display: flex; align-items: center; justify-content: center;
            line-height: 1; transition: all 0.2s ease; z-index: 5;
        }
        .close-btn:hover { background: rgba(0,0,0,0.2); transform: scale(1.1); }
        #detailContainer {
            background: rgba(255, 255, 255, 0.897); border-radius: 10px;
            padding: 20px; margin-top: 20px; box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        #orderDetailForm .form-group { margin-bottom: 15px; }
        #orderDetailForm label { display: block; margin-bottom: 5px; font-weight: bold; color: #555; }
        #orderDetailForm input, #orderDetailForm textarea, #orderDetailForm select {
            width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ddd;
            background: rgba(255, 255, 255, 0.9); font-size: 1em;
        }
        #orderDetailForm textarea { resize: vertical; min-height: 80px; }
        .image-preview-container {
            display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 10px;
        }
        .image-preview-box { text-align: center; }
        .image-preview {
            width: 100%; height: 150px; border-radius: 8px; background: #eee;
            object-fit: cover; border: 2px dashed #ccc; cursor: pointer;
        }
        .image-preview-box input[type="file"] { display: none; }
        #orderConfirmDialog {
            display: none; position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%);
            background: rgba(255, 255, 255, 0.95); border-radius: 15px; padding: 25px;
            box-shadow: 0 5px 25px rgba(0, 0, 0, 0.2); z-index: 40; text-align: center; width: 300px;
        }
        #orderConfirmDialog p { color: #242424; margin-bottom: 20px; font-size: 1.1em; }
        .dialog-buttons { display: flex; gap: 10px; justify-content: center; }
        .dialog-buttons button {
            padding: 10px 20px; border-radius: 8px; border: none; cursor: pointer;
            color: white; font-weight: bold; flex-grow: 1;
        }
        .confirm-btn { background: #ef5350; }
        .cancel-btn { background: #64b5f6; }
        @media (max-width: 600px) {
            .container { padding: 15px; }
            h1 { font-size: 1.5em; }
            #orderList { grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); }
            .image-preview-container { grid-template-columns: 1fr; }
            .image-preview { height: 200px; }
            #orderFormContainer, #orderActionIsland, #orderConfirmDialog { width: calc(100% - 40px); }
        }
    </style>
 </head>
 <body>
  <div class="container">
   <h1>Dress Order Records</h1>
   <div id="overlay"></div>

   <div id="orderSystem">
    <div id="orderControls">
        <button id="createOrderBtn">New Order</button>
        <button id="actionOrderBtn">Actions</button>
        <button id="cancelSelectionBtn">Cancel</button>
        <button id="backToOrdersBtn" style="display:none">Back</button>
    </div>
    <div id="orderList"></div>
   </div>

   <div id="orderFormContainer">
    <form id="orderForm">
     <input type="text" id="orderNameInput" placeholder="Order Name (e.g., Customer's Name)" required>
     <button type="submit" id="orderFormSubmitBtn">Create</button>
    </form>
   </div>

   <div id="orderActionIsland">
    <div class="action-icon delete-icon" id="orderIslandDeleteBtn" title="Delete Order">🗑️</div>
   </div>

   <div id="orderConfirmDialog">
    <p>Are you sure you want to delete the selected order(s)?</p>
    <div class="dialog-buttons">
        <button id="confirmOrderDelete" class="confirm-btn">Delete</button>
        <button id="cancelOrderDelete" class="cancel-btn">Cancel</button>
    </div>
   </div>

   <div id="orderDetailView">
    <button id="closeDetailViewBtn" class="close-btn" title="Close">×</button>
    <div id="detailContainer">
     <h2 id="displayOrderName"></h2>
     <form id="orderDetailForm">
      <div class="form-group"> <label for="customerName">Customer Name</label>
       <input type="text" id="customerName" placeholder="Enter customer's name">
      </div>
      <div class="form-group"> <label for="orderStatus">Status</label>
          <select id="orderStatus">
              <option value="pending">Pending</option>
              <option value="in-progress">In Progress</option>
              <option value="completed">Completed</option>
          </select>
      </div>
      <div class="form-group"> <label for="orderDeadline">Deadline</label> <input type="date" id="orderDeadline"> </div>
      <div class="form-group"> <label for="fittingDate">Fitting Date</label> <input type="date" id="fittingDate"> </div>
      <div class="form-group"> <label for="pickupDate">Pickup Date</label> <input type="date" id="pickupDate"> </div>
      <div class="form-group"> <label for="orderNotes">Notes</label> <textarea id="orderNotes" placeholder="Special requests, measurements, etc."></textarea> </div>
      <div class="image-preview-container">
       <div class="image-preview-box"> <label for="fabricImageFile">Fabric Image</label>
        <img id="fabricImagePreview" class="image-preview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Fabric Preview">
        <input type="file" id="fabricImageFile" accept="image/*">
       </div>
       <div class="image-preview-box"> <label for="designImageFile">Design Image</label>
        <img id="designImagePreview" class="image-preview" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Design Preview">
        <input type="file" id="designImageFile" accept="image/*">
       </div>
      </div>
     </form>
    </div>
    <div class="footer-credit"> ©️ Aung Kaung Myat Production </div>
   </div>
  </div>

  <script>
    // ===================================================================================
    // SCRIPT START
    // ===================================================================================
    document.addEventListener('DOMContentLoaded', () => {

        // --- 1. DOM Element Selections ---
        // အသုံးပြုမယ့် HTML element တွေကို အလွယ်တကူခေါ်သုံးနိုင်အောင် variable များဖြင့်ကြေငြာခြင်း
        const orderSystem = document.getElementById('orderSystem');
        const orderList = document.getElementById('orderList');
        const createOrderBtn = document.getElementById('createOrderBtn');
        const actionOrderBtn = document.getElementById('actionOrderBtn');
        const cancelSelectionBtn = document.getElementById('cancelSelectionBtn');
        const backToOrdersBtn = document.getElementById('backToOrdersBtn');
        
        const overlay = document.getElementById('overlay');
        const orderFormContainer = document.getElementById('orderFormContainer');
        const orderForm = document.getElementById('orderForm');
        const orderNameInput = document.getElementById('orderNameInput');

        const orderActionIsland = document.getElementById('orderActionIsland');
        const orderIslandDeleteBtn = document.getElementById('orderIslandDeleteBtn');
        
        const orderConfirmDialog = document.getElementById('orderConfirmDialog');
        const confirmOrderDelete = document.getElementById('confirmOrderDelete');
        const cancelOrderDelete = document.getElementById('cancelOrderDelete');
        
        const orderDetailView = document.getElementById('orderDetailView');
        const closeDetailViewBtn = document.getElementById('closeDetailViewBtn');
        const displayOrderName = document.getElementById('displayOrderName');
        const orderDetailForm = document.getElementById('orderDetailForm');
        
        // --- 2. State Variables ---
        // App ရဲ့ လက်ရှိအခြေအနေကို မှတ်သားရန် variable များ
        let db; // IndexedDB object
        let currentViewedOrderId = null;
        let selectionMode = false;

        // --- 3. IndexedDB Database Setup ---
        // Offline အသုံးပြုနိုင်ရန် browser ထဲတွင် database တည်ဆောက်ခြင်း
        function initDB() {
            const request = indexedDB.open('dressOrderDB', 1);

            request.onerror = (event) => console.error('Database error:', event.target.error);

            request.onupgradeneeded = (event) => {
                db = event.target.result;
                const objectStore = db.createObjectStore('orders', { keyPath: 'id', autoIncrement: true });
                objectStore.createIndex('name', 'name', { unique: false });
                console.log('Object store created successfully.');
            };

            request.onsuccess = (event) => {
                db = event.target.result;
                console.log('Database opened successfully.');
                renderOrderList(); // DB အောင်မြင်စွာဖွင့်ပြီးလျှင် order list ကို စတင်ပြသမည်
            };
        }

        // --- 4. Database CRUD Functions (Create, Read, Update, Delete) ---
        // Database နှင့် အလုပ်လုပ်ရန် function များ
        
        // Order အသစ်ထည့်ရန်
        const addOrder = (order) => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            const request = store.add(order);
            request.onsuccess = event => resolve(event.target.result); // return the new ID
            request.onerror = event => reject(event.target.error);
        });

        // Order များအားလုံးကို ဖတ်ရန်
        const getAllOrders = () => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.getAll();
            request.onsuccess = () => resolve(request.result);
            request.onerror = event => reject(event.target.error);
        });

        // Order တစ်ခုကို ID ဖြင့်ဖတ်ရန်
        const getOrder = (id) => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readonly');
            const store = transaction.objectStore('orders');
            const request = store.get(id);
            request.onsuccess = () => resolve(request.result);
            request.onerror = event => reject(event.target.error);
        });

        // Order ကို update လုပ်ရန်
        const updateOrder = (order) => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            const request = store.put(order);
            request.onsuccess = () => resolve();
            request.onerror = event => reject(event.target.error);
        });
        
        // Order တစ်ခုကို ID ဖြင့်ဖျက်ရန်
        const deleteOrder = (id) => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            const request = store.delete(id);
            request.onsuccess = () => resolve();
            request.onerror = event => reject(event.target.error);
        });
        
        // Order များကို တပြိုင်နက်ဖျက်ရန်
        const deleteMultipleOrders = (ids) => new Promise((resolve, reject) => {
            const transaction = db.transaction(['orders'], 'readwrite');
            const store = transaction.objectStore('orders');
            let completed = 0;
            ids.forEach(id => {
                const request = store.delete(id);
                request.onsuccess = () => {
                    completed++;
                    if (completed === ids.length) {
                        resolve();
                    }
                };
            });
            transaction.onerror = event => reject(event.target.error);
        });

        // --- 5. UI Rendering Functions ---
        // Data များကို screen ပေါ်တွင်ပြသရန် function များ
        
        // Order list တစ်ခုလုံးကို ပြသရန်
        async function renderOrderList() {
            const orders = await getAllOrders();
            orderList.innerHTML = ''; // Clear existing list
            if (orders.length === 0) {
                orderList.innerHTML = `<p style="grid-column: 1 / -1; text-align: center; color: #555;">No orders found. Click 'New Order' to start.</p>`;
                return;
            }
            orders.forEach(order => {
                const statusClass = `status-${order.status || 'pending'}`;
                const item = document.createElement('div');
                item.className = 'order-item';
                item.dataset.id = order.id;
                item.innerHTML = `
                    <input type="checkbox" class="order-checkbox">
                    <div class="order-icon">👗</div>
                    <div class="order-name">${order.name}</div>
                    <div class="order-status-badge ${statusClass}">${(order.status || 'pending').replace('-', ' ')}</div>
                `;
                orderList.appendChild(item);
            });
        }
        
        // Order card တစ်ခုချင်းစီကို update လုပ်ရန် (status ပြောင်းလဲမှုအတွက်)
        function updateOrderCard(order) {
            const card = orderList.querySelector(`.order-item[data-id='${order.id}']`);
            if (card) {
                const badge = card.querySelector('.order-status-badge');
                const statusClass = `status-${order.status || 'pending'}`;
                badge.className = `order-status-badge ${statusClass}`;
                badge.textContent = (order.status || 'pending').replace('-', ' ');
                const nameDiv = card.querySelector('.order-name');
                nameDiv.textContent = order.name;
            }
        }
        
        // --- 6. UI Interaction and Event Handlers ---
        // User ၏လုပ်ဆောင်ချက်များကိုကိုင်တွယ်ရန် Event Listener များ
        
        // "New Order" ခလုတ်ကို နှိပ်သည့်အခါ
        createOrderBtn.addEventListener('click', () => {
            overlay.style.display = 'block';
            orderFormContainer.classList.add('visible');
            orderNameInput.focus();
        });
        
        // Order အသစ်ဖန်တီးသည့် form ကို submit လုပ်သည့်အခါ
        orderForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const orderName = orderNameInput.value.trim();
            if (orderName) {
                const newOrder = {
                    name: orderName,
                    customerName: orderName, // Default customer name to order name
                    status: 'pending',
                    deadline: '',
                    fittingDate: '',
                    pickupDate: '',
                    notes: '',
                    fabricImage: '',
                    designImage: ''
                };
                const newId = await addOrder(newOrder);
                orderForm.reset();
                hideOverlayAndForms();
                await renderOrderList();
                showOrderDetailView(newId); // Show detail view for the new order
            }
        });
        
        // "Actions" ခလုတ်ကို နှိပ်သည့်အခါ (Selection Mode)
        actionOrderBtn.addEventListener('click', toggleSelectionMode);
        cancelSelectionBtn.addEventListener('click', () => toggleSelectionMode(false));
        
        function toggleSelectionMode(forceOff = null) {
            selectionMode = forceOff !== null ? forceOff : !selectionMode;
            orderList.classList.toggle('selection-mode', selectionMode);
            createOrderBtn.style.display = selectionMode ? 'none' : 'flex';
            actionOrderBtn.style.display = selectionMode ? 'none' : 'flex';
            cancelSelectionBtn.style.display = selectionMode ? 'flex' : 'none';
            
            if (selectionMode) {
                orderActionIsland.classList.add('visible');
            } else {
                orderActionIsland.classList.remove('visible');
                // Deselect all items
                document.querySelectorAll('.order-item.selected').forEach(item => {
                    item.classList.remove('selected');
                    item.querySelector('.order-checkbox').checked = false;
                });
            }
        }
        
        // Order card ကို နှိပ်သည့်အခါ
        orderList.addEventListener('click', (e) => {
            const item = e.target.closest('.order-item');
            if (!item) return;

            const id = parseInt(item.dataset.id);
            if (selectionMode) {
                item.classList.toggle('selected');
                item.querySelector('.order-checkbox').checked = item.classList.contains('selected');
            } else {
                showOrderDetailView(id);
            }
        });

        // Detail View ကိုပြသရန်
        async function showOrderDetailView(id) {
            currentViewedOrderId = id;
            const order = await getOrder(id);
            if (!order) return;

            // Populate form
            displayOrderName.textContent = order.name;
            orderDetailForm.querySelector('#customerName').value = order.customerName || '';
            orderDetailForm.querySelector('#orderStatus').value = order.status || 'pending';
            orderDetailForm.querySelector('#orderDeadline').value = order.deadline || '';
            orderDetailForm.querySelector('#fittingDate').value = order.fittingDate || '';
            orderDetailForm.querySelector('#pickupDate').value = order.pickupDate || '';
            orderDetailForm.querySelector('#orderNotes').value = order.notes || '';
            
            // Populate images
            const fabricPreview = document.getElementById('fabricImagePreview');
            const designPreview = document.getElementById('designImagePreview');
            fabricPreview.src = order.fabricImage || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';
            designPreview.src = order.designImage || 'data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=';

            // Show view
            orderSystem.style.display = 'none';
            orderDetailView.style.display = 'block';
            backToOrdersBtn.style.display = 'block';
            createOrderBtn.style.display = 'none';
            actionOrderBtn.style.display = 'none';
        }
        
        // Detail form ထဲမှ data ပြောင်းလဲမှုတိုင်းကို auto-save လုပ်ရန်
        orderDetailForm.addEventListener('change', async (e) => {
            if (!currentViewedOrderId) return;
            
            const order = await getOrder(currentViewedOrderId);
            if(!order) return;

            // Update text/date/select values
            order.customerName = document.getElementById('customerName').value;
            order.status = document.getElementById('orderStatus').value;
            order.deadline = document.getElementById('orderDeadline').value;
            order.fittingDate = document.getElementById('fittingDate').value;
            order.pickupDate = document.getElementById('pickupDate').value;
            order.notes = document.getElementById('orderNotes').value;
            
            // Handle image file changes
            if (e.target.type === 'file') {
                const file = e.target.files[0];
                if (file) {
                    const base64String = await fileToBase64(file);
                    if (e.target.id === 'fabricImageFile') {
                        order.fabricImage = base64String;
                        document.getElementById('fabricImagePreview').src = base64String;
                    } else if (e.target.id === 'designImageFile') {
                        order.designImage = base64String;
                        document.getElementById('designImagePreview').src = base64String;
                    }
                }
            }
            
            await updateOrder(order);
            updateOrderCard(order); // Live update the card in the list
            console.log('Order saved automatically.');
        });
        
        // ပုံရွေးရန် click လုပ်နိုင်အောင်
        document.getElementById('fabricImagePreview').addEventListener('click', () => document.getElementById('fabricImageFile').click());
        document.getElementById('designImagePreview').addEventListener('click', () => document.getElementById('designImageFile').click());

        // Detail View ကို ပိတ်ရန် (သို့) နောက်ပြန်သွားရန်
        const backToList = () => {
            orderDetailView.style.display = 'none';
            orderSystem.style.display = 'block';
            backToOrdersBtn.style.display = 'none';
            createOrderBtn.style.display = 'flex';
            actionOrderBtn.style.display = 'flex';
            currentViewedOrderId = null;
            renderOrderList(); // Refresh list in case names changed
        };
        closeDetailViewBtn.addEventListener('click', backToList);
        backToOrdersBtn.addEventListener('click', backToList);
        
        // --- 7. Bulk Actions and Dialogs ---
        // အများလိုက်လုပ်ဆောင်မှုများနှင့် သတိပေး dialog များ
        
        // Delete icon ကို နှိပ်သည့်အခါ
        orderIslandDeleteBtn.addEventListener('click', () => {
            const selectedItems = document.querySelectorAll('.order-item.selected');
            if (selectedItems.length > 0) {
                overlay.style.display = 'block';
                orderConfirmDialog.style.display = 'block';
            } else {
                alert('Please select at least one order to delete.');
            }
        });

        // Delete ကို confirm လုပ်သည့်အခါ
        confirmOrderDelete.addEventListener('click', async () => {
            const selectedIds = Array.from(document.querySelectorAll('.order-item.selected'))
                .map(item => parseInt(item.dataset.id));
            
            await deleteMultipleOrders(selectedIds);
            hideOverlayAndForms();
            toggleSelectionMode(false); // Exit selection mode
            await renderOrderList();
        });

        // Delete ကို cancel လုပ်သည့်အခါ
        cancelOrderDelete.addEventListener('click', hideOverlayAndForms);
        overlay.addEventListener('click', hideOverlayAndForms);

        // --- 8. Helper Functions ---
        // အထောက်အကူပြု function များ
        
        function hideOverlayAndForms() {
            overlay.style.display = 'none';
            orderFormContainer.classList.remove('visible');
            orderConfirmDialog.style.display = 'none';
        }
        
        // Image file ကို Base64 string သို့ပြောင်းရန်
        const fileToBase64 = (file) => new Promise((resolve, reject) => {
            const reader = new FileReader();
            reader.readAsDataURL(file);
            reader.onload = () => resolve(reader.result);
            reader.onerror = error => reject(error);
        });

        // --- 9. Initialize the App ---
        // App ကိုစတင်ခြင်း
        initDB();

        // --- 10. PWA Service Worker Registration ---
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('/sw.js')
                    .then(registration => {
                        console.log('ServiceWorker registration successful with scope: ', registration.scope);
                    })
                    .catch(err => {
                        console.log('ServiceWorker registration failed: ', err);
                    });
            });
        }
    });
    // ===================================================================================
    // SCRIPT END
    // ===================================================================================
  </script>
 
</body></html>
